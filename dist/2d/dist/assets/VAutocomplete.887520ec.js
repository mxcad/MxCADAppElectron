import{al as Y,H as M,r as y,am as Z,u as T,an as B,ao as q,B as ee,ap as te,a9 as le,aq as ae,ar as ne,as as ue,E as D,at as oe,au as se,m as R,L as j,J as re,f as N,b as i,F as z,av as ie,N as x,aw as ce,ax as U,ak as fe,ay as ve,P as de,k as me,K as he}from"./index.6d6dbeea.js";const pe=(e,n,l)=>e==null||n==null?-1:e.toString().toLocaleLowerCase().indexOf(n.toString().toLocaleLowerCase()),ye=Y({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function ge(e,n,l){const g=[],p=l?.default??pe,c=l?.filterKeys?B(l.filterKeys):!1,s=Object.keys(l?.customKeyFilter??{}).length;if(!e?.length)return g;e:for(let h=0;h<e.length;h++){const o=e[h],r={},m={};let f=-1;if(n&&!l?.noFilter){if(typeof o=="object"){const v=c||Object.keys(o);for(const F of v){const V=q(o,F,o),b=l?.customKeyFilter?.[F];if(f=b?b(V,n,o):p(V,n,o),f!==-1&&f!==!1)b?r[F]=f:m[F]=f;else if(l?.filterMode==="every")continue e}}else f=p(o,n,o),f!==-1&&f!==!1&&(m.title=f);const k=Object.keys(m).length,u=Object.keys(r).length;if(!k&&!u||l?.filterMode==="union"&&u!==s&&!k||l?.filterMode==="intersection"&&(u!==s||!k))continue}g.push({index:h,matches:{...m,...r}})}return g}function ke(e,n,l,g){const p=M(()=>typeof l?.value!="string"&&typeof l?.value!="number"?"":String(l.value)),c=y([]),s=y(new Map);Z(()=>{c.value=[],s.value=new Map;const o=T(n);ge(o,p.value,{customKeyFilter:e.customKeyFilter,default:e.customFilter,filterKeys:T(g?.filterKeys)??e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}).forEach(m=>{let{index:f,matches:k}=m;const u=o[f];c.value.push(u),s.value.set(u.value,k)})});function h(o){return s.value.get(o.value)}return{filteredItems:c,filteredMatches:s,getMatches:h}}function Fe(e,n,l){if(n==null)return e;if(Array.isArray(n))throw new Error("Multiple matches is not implemented");return typeof n=="number"&&~n?i(z,null,[i("span",{class:"v-autocomplete__unmask"},[e.substr(0,n)]),i("span",{class:"v-autocomplete__mask"},[e.substr(n,l)]),i("span",{class:"v-autocomplete__unmask"},[e.substr(n+l)])]):e}const Ce=ee()({name:"VAutocomplete",props:{search:String,...ye({filterKeys:["title"]}),...te(),...le(ae({modelValue:null}),["validationValue","dirty","appendInnerIcon"]),...ne({transition:!1})},emits:{"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,n){let{slots:l}=n;const{t:g}=ue(),p=y(),c=y(!1),s=y(!0),h=y(),o=D(e,"menu"),r=M({get:()=>o.value,set:t=>{o.value&&!t&&h.value?.\u03A8openChildren||(o.value=t)}}),{items:m,transformIn:f,transformOut:k}=oe(e),u=D(e,"search",""),v=D(e,"modelValue",[],t=>f(B(t)),t=>{const d=k(t);return e.multiple?d:d[0]??null}),F=se(),{filteredItems:V,getMatches:b}=ke(e,m,M(()=>s.value?void 0:u.value)),I=M(()=>v.value.map(t=>m.value.find(d=>e.valueComparator(d.value,t.value))||t)),A=M(()=>e.hideSelected?V.value.filter(t=>!I.value.some(d=>d.value===t.value)):V.value),O=M(()=>I.value.map(t=>t.props.value)),L=y();function H(t){e.openOnClear&&(r.value=!0),u.value=""}function $(){e.hideNoData&&!m.value.length||e.readonly||F?.isReadonly.value||(r.value=!0)}function J(t){e.readonly||F?.isReadonly.value||(["Enter","ArrowDown","ArrowUp"].includes(t.key)&&t.preventDefault(),["Enter","ArrowDown"].includes(t.key)&&(r.value=!0),["Escape"].includes(t.key)&&(r.value=!1),["Enter","Escape","Tab"].includes(t.key)&&(s.value=!0),t.key==="ArrowDown"?L.value?.focus("next"):t.key==="ArrowUp"&&L.value?.focus("prev"))}function Q(t){u.value=t.target.value}function G(){c.value&&(s.value=!0)}function W(t){c.value=!0}function X(t){t.relatedTarget==null&&p.value?.focus()}const K=y(!1);function P(t){if(e.multiple){const d=O.value.findIndex(C=>e.valueComparator(C,t.value));if(d===-1)v.value=[...v.value,t],u.value="";else{const C=[...v.value];C.splice(d,1),v.value=C}}else v.value=[t],K.value=!0,l.selection||(u.value=t.title),r.value=!1,s.value=!0,j(()=>K.value=!1)}return R(c,t=>{t?(K.value=!0,u.value=e.multiple||!!l.selection?"":String(I.value.at(-1)?.props.title??""),s.value=!0,j(()=>K.value=!1)):(r.value=!1,u.value="")}),R(u,t=>{!c.value||K.value||(t&&(r.value=!0),s.value=!t)}),re(()=>{const t=!!(e.chips||l.chip),d=!!(!e.hideNoData||A.value.length||l.prepend||l.append||l["no-data"]),[C]=N.filterProps(e);return i(N,x({ref:p},C,{modelValue:u.value,"onUpdate:modelValue":a=>{a==null&&(v.value=[])},validationValue:v.externalValue,dirty:v.value.length>0,onInput:Q,class:["v-autocomplete",{"v-autocomplete--active-menu":r.value,"v-autocomplete--chips":!!e.chips,[`v-autocomplete--${e.multiple?"multiple":"single"}`]:!0,"v-autocomplete--selection-slot":!!l.selection}],appendInnerIcon:e.menuIcon,readonly:e.readonly,"onClick:clear":H,"onMousedown:control":$,onFocus:()=>c.value=!0,onBlur:()=>c.value=!1,onKeydown:J}),{...l,default:()=>i(z,null,[i(ie,x({ref:h,modelValue:r.value,"onUpdate:modelValue":a=>r.value=a,activator:"parent",contentClass:"v-autocomplete__content",eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:G},e.menuProps),{default:()=>[d&&i(ce,{ref:L,selected:O.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:a=>a.preventDefault(),onFocusin:W,onFocusout:X},{default:()=>[!A.value.length&&!e.hideNoData&&(l["no-data"]?.()??i(U,{title:g(e.noDataText)},null)),l["prepend-item"]?.(),A.value.map((a,w)=>l.item?.({item:a,index:w,props:x(a.props,{onClick:()=>P(a)})})??i(U,x({key:w},a.props,{onClick:()=>P(a)}),{prepend:S=>{let{isSelected:_}=S;return e.multiple&&!e.hideSelected?i(fe,{modelValue:_,ripple:!1},null):void 0},title:()=>s.value?a.title:Fe(a.title,b(a)?.title,u.value?.length??0)})),l["append-item"]?.()]})]}),I.value.map((a,w)=>{function S(E){E.stopPropagation(),E.preventDefault(),P(a)}const _={"onClick:close":S,modelValue:!0,"onUpdate:modelValue":void 0};return i("div",{key:a.value,class:"v-autocomplete__selection"},[t?l.chip?i(de,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:a.title}}},{default:()=>[l.chip?.({item:a,index:w,props:_})]}):i(ve,x({key:"chip",closable:e.closableChips,size:"small",text:a.title},_),null):l.selection?.({item:a,index:w})??i("span",{class:"v-autocomplete__selection-text"},[a.title,e.multiple&&w<I.value.length-1&&i("span",{class:"v-autocomplete__selection-comma"},[me(",")])])])})])})}),he({isFocused:c,isPristine:s,menu:r,search:u,filteredItems:V,select:P},p)}});export{Ce as V};
